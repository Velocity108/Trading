<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dark Trading Interface — Binance (Public Data) + Demo Trades</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f141b;
      --accent: #00c68e;
      --accent-2: #3b82f6;
      --text: #e5eef7;
      --muted: #93a4b7;
      --danger: #ef4444;
      --warning: #f59e0b;
      --good: #22c55e;
      --card: #0e1218;
      --border: #1f2937;
      --buy: #16a34a;
      --sell: #ef4444;
      --shadow: 0 6px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      --radius-xl: 18px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 70% -10%, #0f172a 0%, var(--bg) 40%) no-repeat fixed;
      color: var(--text);
    }

    /* Layout */
    .app {
      display: grid;
      grid-template-columns: 280px 1fr 360px;
      grid-template-rows: auto 1fr auto;
      gap: 14px;
      padding: 14px;
      min-height: 100vh;
    }

    header {
      grid-column: 1 / -1;
      background: linear-gradient(180deg, #0f1520, var(--panel));
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 14px;
      z-index: 50;
    }

    header .brand {
      display: flex; align-items: center; gap: 12px;
      font-weight: 700;
    }
    .pill {
      background: #0b1220; border: 1px solid var(--border);
      padding: 6px 10px; border-radius: 999px; color: var(--muted);
      font-size: 12px;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
    }

    /* Left column */
    .left { padding: 12px; display: grid; gap: 12px; height: calc(100vh - 110px); overflow: auto; }
    .section-title { color: var(--muted); font-size: 12px; letter-spacing: .08em; text-transform: uppercase; margin: 8px 0 6px; }
    .search {
      display: flex; gap: 8px; align-items: center;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px; padding: 8px 10px;
    }
    .search input { flex: 1; background: transparent; border: 0; outline: none; color: var(--text); }

    .symbols { max-height: 50vh; overflow: auto; border-radius: 12px; border: 1px solid var(--border); }
    .symbols table { width: 100%; border-collapse: collapse; }
    .symbols tr { border-bottom: 1px solid var(--border); }
    .symbols tr:hover { background: #0d1420; cursor: pointer; }
    .symbols td { padding: 8px 10px; font-size: 13px; }
    .tag { font-size: 10px; color: var(--muted); border: 1px solid var(--border); padding: 2px 6px; border-radius: 999px; }

    /* Center column */
    .center { display: grid; grid-template-rows: 420px 1fr; gap: 12px; }
    #chart { border-radius: var(--radius-xl); border: 1px solid var(--border); background: var(--card); box-shadow: var(--shadow); }

    .tickerbar { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
    .tick {
      background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 10px;
      display: grid; gap: 6px; align-content: center;
    }
    .tick .label { font-size: 11px; color: var(--muted); }
    .tick .value { font-size: 16px; font-weight: 700; }

    /* Right column */
    .right { display: grid; grid-template-rows: auto auto 1fr; gap: 12px; }

    .orderform { padding: 12px; display: grid; gap: 10px; }
    .tabs { display:flex; background: #0b1220; border: 1px solid var(--border); border-radius: 10px; padding: 4px; }
    .tabs button { flex:1; background: transparent; border: 0; color: var(--muted); padding: 8px; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .tabs button.active { background: #0e1a2b; color: var(--text); border: 1px solid var(--border); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .field { display: grid; gap: 6px; }
    .field label { font-size: 11px; color: var(--muted); }
    .field input, .field select { background: #0c1320; border: 1px solid var(--border); color: var(--text); border-radius: 8px; padding: 10px; outline: none; }
    .btn { padding: 12px; border: 0; border-radius: 12px; font-weight: 800; cursor: pointer; }
    .btn.buy { background: linear-gradient(180deg, #0a2f1a, #0e1f15); border: 1px solid #134e33; color: #9ee6c0; }
    .btn.sell { background: linear-gradient(180deg, #2b1414, #1a0f10); border: 1px solid #5a1a1a; color: #f2a5a5; }
    .note { font-size: 12px; color: var(--muted); }

    .book { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
    .book h4 { margin: 6px 0; font-size: 12px; color: var(--muted); }
    .levels { max-height: 220px; overflow: auto; border: 1px solid var(--border); border-radius: 10px; }
    .levels table { width: 100%; border-collapse: collapse; font-variant-numeric: tabular-nums; }
    .levels td { padding: 6px 8px; font-size: 12px; border-bottom: 1px solid var(--border); }
    .levels tr.buy td { color: #9ee6c0; }
    .levels tr.sell td { color: #f2a5a5; }

    .feed { padding: 10px; }
    .feed h4 { margin: 6px 0 8px; font-size: 12px; color: var(--muted); }
    .feedlist { max-height: 220px; overflow: auto; border: 1px solid var(--border); border-radius: 10px; }
    .feedlist table { width: 100%; border-collapse: collapse; font-variant-numeric: tabular-nums; }
    .feedlist td { padding: 6px 8px; font-size: 12px; border-bottom: 1px solid var(--border); }

    .bottom {
      grid-column: 1 / -1; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
    }
    .card { background: var(--panel); border:1px solid var(--border); border-radius: var(--radius-xl); box-shadow: var(--shadow); padding: 12px; }
    table.grid { width: 100%; border-collapse: collapse; }
    table.grid th, table.grid td { text-align: left; padding: 8px; font-size: 13px; border-bottom: 1px solid var(--border); }
    table.grid th { color: var(--muted); font-weight: 600; }

    .status { font-size: 11px; padding: 2px 6px; border-radius: 999px; border:1px solid var(--border); color: var(--muted); }
    .status.open { color:#9ee6c0; border-color:#134e33; background:#0a2f1a; }
    .status.filled { color:#cbd5e1; background:#0b1220; }

    footer { grid-column: 1 / -1; color: var(--muted); font-size: 12px; text-align: center; padding: 10px 0; }

    @media (max-width: 1200px) {
      .app { grid-template-columns: 1fr; }
      .center { grid-template-rows: 360px auto; }
      .right, .left { height: auto; }
      .bottom { grid-template-columns: 1fr; }
    }
  </style>
  <!-- Lightweight Charts (for candlesticks) -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
  <div class="app">
    <header class="panel">
      <div class="brand">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2l3.5 3.5L12 9 8.5 5.5 12 2zm0 6l3.5 3.5L12 15 8.5 11.5 12 8zm0 6l3.5 3.5L12 21l-3.5-3.5L12 14z" fill="#00c68e"/></svg>
        <div>Dark Trader <span class="pill">Binance Public Feed</span></div>
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <div class="pill" id="connection">ws: —</div>
        <div class="pill">Demo mode (no keys)</div>
      </div>
    </header>

    <!-- LEFT: Symbols -->
    <aside class="left panel">
      <div>
        <div class="section-title">Symbol</div>
        <div class="search">
          <input id="search" placeholder="Search e.g. BTCUSDT" />
          <span class="tag">Spot</span>
        </div>
        <div class="symbols" id="symbols"></div>
      </div>

      <div>
        <div class="section-title">Order Book</div>
        <div class="book panel" style="background:transparent;border:0;box-shadow:none;padding:0;">
          <div>
            <h4>Asks</h4>
            <div class="levels"><table id="asks"></table></div>
          </div>
          <div>
            <h4>Bids</h4>
            <div class="levels"><table id="bids"></table></div>
          </div>
        </div>
      </div>

      <div>
        <div class="section-title">Recent Trades</div>
        <div class="feed">
          <div class="feedlist"><table id="trades"></table></div>
        </div>
      </div>
    </aside>

    <!-- CENTER: Chart + Ticker -->
    <main class="center">
      <div id="chart" class="panel"></div>
      <div class="tickerbar">
        <div class="tick"><div class="label">Last Price</div><div class="value" id="lastPrice">—</div></div>
        <div class="tick"><div class="label">24h Change</div><div class="value" id="change">—</div></div>
        <div class="tick"><div class="label">24h High</div><div class="value" id="high">—</div></div>
        <div class="tick"><div class="label">24h Low</div><div class="value" id="low">—</div></div>
        <div class="tick"><div class="label">24h Vol (Base)</div><div class="value" id="vol">—</div></div>
        <div class="tick"><div class="label">Server Time</div><div class="value" id="servertime">—</div></div>
      </div>
    </main>

    <!-- RIGHT: Order Form -->
    <aside class="right">
      <div class="panel orderform">
        <div class="tabs">
          <button class="active" data-type="market">Market</button>
          <button data-type="limit">Limit</button>
        </div>
        <div class="row">
          <div class="field"><label>Qty</label><input id="qty" type="number" step="0.0001" min="0" placeholder="0.001" /></div>
          <div class="field"><label>Price</label><input id="price" type="number" step="0.01" min="0" placeholder="Market" disabled /></div>
        </div>
        <div class="row">
          <div class="field"><label>Notional (USDT)</label><input id="notional" type="number" step="0.01" min="0" placeholder="Auto" /></div>
          <div class="field"><label>Time in Force</label>
            <select id="tif">
              <option value="GTC">GTC</option>
              <option value="IOC">IOC</option>
              <option value="FOK">FOK</option>
            </select>
          </div>
        </div>
        <button class="btn buy" id="buy">Buy</button>
        <button class="btn sell" id="sell">Sell</button>
        <div class="note">Orders run in <b>Demo mode</b> (local P&L). To place real orders, wire a small backend that signs Binance API requests. Endpoint contract is documented in the code (\n/** BACKEND CONTRACT **/).</div>
      </div>

      <div class="panel book">
        <div>
          <h4>Top Asks</h4>
          <div class="levels"><table id="asks2"></table></div>
        </div>
        <div>
          <h4>Top Bids</h4>
          <div class="levels"><table id="bids2"></table></div>
        </div>
      </div>

      <div class="panel feed">
        <h4>System Log</h4>
        <div class="feedlist"><table id="log"></table></div>
      </div>
    </aside>

    <!-- BOTTOM: Orders & Positions -->
    <section class="bottom">
      <div class="card">
        <div class="section-title">Open Orders (Demo)</div>
        <table class="grid" id="orders">
          <thead><tr><th>ID</th><th>Side</th><th>Type</th><th>Price</th><th>Qty</th><th>Status</th><th>Action</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card">
        <div class="section-title">Positions (Demo)</div>
        <table class="grid" id="positions">
          <thead><tr><th>Symbol</th><th>Side</th><th>Qty</th><th>Avg Price</th><th>UPnL</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <footer>
      Built for education. Uses Binance public REST/WS endpoints only. For real trading, add a server that signs requests with your API key/secret (never put them in the browser).
    </footer>
  </div>

  <script>
    /**
     * Dark Trader — Single-file interface using Binance public feeds.
     * DISCLAIMER: This is a client-side demo. Do not expose API keys here.
     *
     * FEATURES
     * - Live symbol list (top USDT pairs)
     * - Live ticker (24h stats)
     * - Candlestick chart (Lightweight Charts)
     * - Order book (depth 20)
     * - Trades tape
     * - Demo order/position simulation (localStorage)
     * - Optional backend contract for REAL orders (see BACKEND CONTRACT below)
     */

    const UI = {
      symbols: document.getElementById('symbols'),
      search: document.getElementById('search'),
      asks: document.getElementById('asks'),
      bids: document.getElementById('bids'),
      asks2: document.getElementById('asks2'),
      bids2: document.getElementById('bids2'),
      trades: document.getElementById('trades'),
      last: document.getElementById('lastPrice'),
      change: document.getElementById('change'),
      high: document.getElementById('high'),
      low: document.getElementById('low'),
      vol: document.getElementById('vol'),
      time: document.getElementById('servertime'),
      chart: document.getElementById('chart'),
      connection: document.getElementById('connection'),
      tabs: document.querySelectorAll('.tabs button'),
      qty: document.getElementById('qty'),
      price: document.getElementById('price'),
      notional: document.getElementById('notional'),
      tif: document.getElementById('tif'),
      buy: document.getElementById('buy'),
      sell: document.getElementById('sell'),
      orders: document.querySelector('#orders tbody'),
      positions: document.querySelector('#positions tbody'),
      log: document.getElementById('log'),
    };

    const state = {
      symbol: (localStorage.getItem('symbol') || 'BTCUSDT').toUpperCase(),
      interval: localStorage.getItem('interval') || '1m',
      ws: null,
      streams: {},
      book: { asks: [], bids: [] },
      tick: {},
      orders: JSON.parse(localStorage.getItem('orders')||'[]'),
      positions: JSON.parse(localStorage.getItem('positions')||'[]'),
    };

    /** Utility */
    const fmt = (n, p=2) => {
      if (n===undefined||n===null||isNaN(n)) return '—';
      return Number(n).toLocaleString(undefined, {maximumFractionDigits:p});
    }
    const row = (...cells) => `<tr>${cells.map(c=>`<td>${c}</td>`).join('')}</tr>`;
    const log = (msg) => UI.log.insertAdjacentHTML('afterbegin', row(new Date().toLocaleTimeString(), msg));

    /** SYMBOLS **/
    async function loadSymbols() {
      const res = await fetch('https://api.binance.com/api/v3/ticker/24hr');
      const data = await res.json();
      const usdt = data.filter(s => s.symbol.endsWith('USDT'))
        .sort((a,b)=> Number(b.quoteVolume) - Number(a.quoteVolume))
        .slice(0, 120);

      const draw = (list) => {
        UI.symbols.innerHTML = `<table>${list.map(s=>
          row(`<b>${s.symbol}</b>`,
              `<span class='tag'>Vol ${fmt(s.volume,0)}</span>`,
              `<span style='color:${Number(s.priceChangePercent)>=0?'#9ee6c0':'#f2a5a5'}'>${fmt(s.lastPrice)}</span>`)).join('')}</table>`;
        [...UI.symbols.querySelectorAll('tr')].forEach((tr, i)=>{
          const sym = list[i].symbol;
          tr.addEventListener('click', ()=> selectSymbol(sym));
        });
      };

      draw(usdt);
      UI.search.addEventListener('input', (e)=>{
        const q = e.target.value.trim().toUpperCase();
        const filtered = usdt.filter(s => s.symbol.includes(q));
        draw(filtered);
      });
    }

    /** CHART **/
    let chart, candleSeries, volumeSeries;
    function initChart() {
      if (chart) { chart.remove(); }
      chart = LightweightCharts.createChart(UI.chart, {
        layout: { background: { type: 'solid', color: '#0e1218' }, textColor: '#d5e1ee' },
        rightPriceScale: { borderColor: '#1f2937' },
        timeScale: { borderColor: '#1f2937' },
        grid: { vertLines: { color: '#101826' }, horzLines: { color: '#101826' } },
        crosshair: { mode: 1 },
      });
      candleSeries = chart.addCandlestickSeries({ upColor: '#16a34a', downColor: '#ef4444', borderUpColor: '#16a34a', borderDownColor: '#ef4444', wickUpColor: '#16a34a', wickDownColor: '#ef4444' });
      volumeSeries = chart.addHistogramSeries({ priceScaleId: '', priceFormat: { type: 'volume' } });
      chart.priceScale('').applyOptions({ scaleMargins: { top: 0.8, bottom: 0 } });
    }

    async function loadKlines(symbol, interval='1m', limit=500) {
      const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
      const res = await fetch(url);
      const data = await res.json();
      const candles = data.map(k => ({ time: Math.floor(k[0]/1000), open: +k[1], high: +k[2], low: +k[3], close: +k[4] }));
      const volume = data.map(k => ({ time: Math.floor(k[0]/1000), value: +k[5], color: (+k[4] >= +k[1]) ? '#1f4f3a' : '#4a2424' }));
      candleSeries.setData(candles);
      volumeSeries.setData(volume);
      chart.timeScale().fitContent();
    }

    /** WEBSOCKETS **/
    function closeStreams() {
      Object.values(state.streams).forEach(ws=>{ try{ ws.close(); }catch(e){} });
      state.streams = {};
    }

    function openStream(name, url, onmsg) {
      const ws = new WebSocket(url);
      state.streams[name] = ws;
      ws.onopen = ()=> { UI.connection.textContent = `ws: connected (${name})`; };
      ws.onclose = ()=> { UI.connection.textContent = `ws: closed (${name})`; };
      ws.onerror = ()=> { UI.connection.textContent = `ws: error (${name})`; };
      ws.onmessage = onmsg;
      return ws;
    }

    function streamTicker(symbol) {
      const s = symbol.toLowerCase();
      openStream('ticker', `wss://stream.binance.com:9443/ws/${s}@ticker`, (ev)=>{
        const d = JSON.parse(ev.data);
        state.tick = d;
        UI.last.textContent = fmt(d.c, 4);
        UI.change.textContent = `${fmt(d.P, 2)}%`;
        UI.high.textContent = fmt(d.h, 4);
        UI.low.textContent = fmt(d.l, 4);
        UI.vol.textContent = fmt(d.v, 0);
        UI.time.textContent = new Date(d.E).toLocaleTimeString();
        // Update limit order default price
        if (!UI.price.disabled) UI.price.value = d.c;
      });
    }

    function streamDepth(symbol) {
      const s = symbol.toLowerCase();
      openStream('depth', `wss://stream.binance.com:9443/ws/${s}@depth20@100ms`, (ev)=>{
        const d = JSON.parse(ev.data);
        state.book.asks = d.asks.map(([p,q])=>({p:+p,q:+q}));
        state.book.bids = d.bids.map(([p,q])=>({p:+p,q:+q}));
        renderBook();
      });
    }

    function streamTrades(symbol) {
      const s = symbol.toLowerCase();
      openStream('trades', `wss://stream.binance.com:9443/ws/${s}@trade`, (ev)=>{
        const t = JSON.parse(ev.data);
        UI.trades.insertAdjacentHTML('afterbegin', row(new Date(t.T).toLocaleTimeString(), t.m? 'SELL':'BUY', fmt(t.p, 4), fmt(t.q, 4)));
        // Keep list short
        while (UI.trades.rows.length > 50) UI.trades.deleteRow(-1);
      });
    }

    function renderBook(){
      const asks = state.book.asks.slice(0, 20);
      const bids = state.book.bids.slice(0, 20);
      const draw = (el, side, arr) => {
        el.innerHTML = arr.map(l=>`<tr class='${side}'>`+
          `<td>${fmt(l.p,4)}</td><td>${fmt(l.q,4)}</td><td>${fmt(l.p*l.q,2)}</td>`+
          `</tr>`).join('');
      };
      draw(UI.asks, 'sell', asks);
      draw(UI.asks2, 'sell', asks);
      draw(UI.bids, 'buy', bids);
      draw(UI.bids2, 'buy', bids);
    }

    async function selectSymbol(symbol){
      state.symbol = symbol.toUpperCase();
      localStorage.setItem('symbol', state.symbol);
      log(`Symbol changed to ${state.symbol}`);
      closeStreams();
      initChart();
      await loadKlines(state.symbol, state.interval, 600);
      streamTicker(state.symbol);
      streamDepth(state.symbol);
      streamTrades(state.symbol);
    }

    /** ORDERS & POSITIONS (Demo) **/
    function saveDemo(){
      localStorage.setItem('orders', JSON.stringify(state.orders));
      localStorage.setItem('positions', JSON.stringify(state.positions));
      renderOrders();
      renderPositions();
    }

    function renderOrders(){
      UI.orders.innerHTML = state.orders.slice().reverse().map(o=>
        row(o.id, o.side, o.type, fmt(o.price,4), fmt(o.qty,6), `<span class='status ${o.status}'>${o.status}</span>`, `<button data-cancel='${o.id}'>Cancel</button>`)
      ).join('');
      UI.orders.querySelectorAll('button[data-cancel]')?.forEach(btn=>btn.addEventListener('click', ()=> cancelOrder(btn.dataset.cancel)));
    }

    function renderPositions(){
      UI.positions.innerHTML = state.positions.map(p=>{
        const last = Number(state.tick?.c || 0);
        const upnl = p.side==='LONG' ? (last - p.avg)*p.qty : (p.avg - last)*p.qty;
        return row(p.symbol, p.side, fmt(p.qty,6), fmt(p.avg,4), `${fmt(upnl, 4)}`);
      }).join('');
    }

    function placeDemoOrder(side){
      const type = [...UI.tabs].find(t=>t.classList.contains('active')).dataset.type.toUpperCase();
      const id = 'D'+Date.now();
      const qty = Number(UI.qty.value||0);
      const price = type==='MARKET' ? Number(state.tick?.c||0) : Number(UI.price.value||state.tick?.c||0);
      if (!qty || !price) { log('Enter quantity.'); return; }

      const order = { id, symbol: state.symbol, side: side.toUpperCase(), type, qty, price, status:'open' };
      state.orders.push(order);
      // Fill logic (simple): market fills instantly; limit fills if price crosses next tick
      if (type==='MARKET') {
        fillOrder(order, price);
      } else {
        // pending; will check on each ticker event
      }
      saveDemo();
      log(`${side.toUpperCase()} ${qty} ${state.symbol} @ ${fmt(price,4)} (${type})`);
    }

    function cancelOrder(id){
      const i = state.orders.findIndex(o=>o.id===id);
      if (i>-1) { state.orders.splice(i,1); saveDemo(); log(`Order ${id} canceled`); }
    }

    function onTickFillCheck(){
      const last = Number(state.tick?.c||0);
      state.orders.filter(o=>o.status==='open' && o.type==='LIMIT').forEach(o=>{
        const cross = (o.side==='BUY') ? (last <= o.price) : (last >= o.price);
        if (cross) fillOrder(o, o.price);
      });
      saveDemo();
    }

    function fillOrder(o, px){
      o.status = 'filled';
      // position update
      let pos = state.positions.find(p=>p.symbol===o.symbol && ((o.side==='BUY' && p.side==='LONG') || (o.side==='SELL' && p.side==='SHORT')));
      if (!pos) {
        pos = { symbol: o.symbol, side: o.side==='BUY'?'LONG':'SHORT', qty: 0, avg: 0 };
        state.positions.push(pos);
      }
      const notional = pos.qty*pos.avg;
      pos.qty += o.qty;
      pos.avg = (notional + o.qty*px) / (pos.qty || 1);
    }

    /** BACKEND CONTRACT (optional) **/
    /**
     * If you wire a backend, POST here instead of placeDemoOrder:
     *   POST {backendUrl}/order
     *   Headers: { 'Authorization': 'Bearer <your_app_token>', 'Content-Type': 'application/json' }
     *   Body: { symbol, side, type, qty, price, tif }
     * Your backend should:
     *   - Add API key, timestamp, and sign the body with HMAC SHA256 using Binance SECRET
     *   - Call Binance /api/v3/order (for Spot) or /fapi/v1/order (for Futures)
     *   - Return the exchange order response
     * SECURITY: Never put apiKey/secret in the browser. Handle CORS on the backend.
     */

    /** UI Events **/
    UI.tabs.forEach(t=> t.addEventListener('click', ()=>{
      UI.tabs.forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      const type = t.dataset.type;
      UI.price.disabled = (type==='market');
      UI.price.placeholder = (type==='market')? 'Market' : 'Limit price';
    }));

    UI.buy.addEventListener('click', ()=> placeDemoOrder('BUY'));
    UI.sell.addEventListener('click', ()=> placeDemoOrder('SELL'));

    // periodic tick check for limit fills
    setInterval(onTickFillCheck, 800);

    // INIT
    (async function init(){
      initChart();
      await Promise.all([loadSymbols(), loadKlines(state.symbol, state.interval, 600)]);
      streamTicker(state.symbol);
      streamDepth(state.symbol);
      streamTrades(state.symbol);
      renderOrders();
      renderPositions();
      log('App ready.');
    })();
  </script>
</body>
</html>
